# 4.4 黄金分割探索
主なFibonacci探索の不利益は反復の回数を入力として与えなければならないことである。
目的関数の極小または最小値が望ましい正確さを達成するまで反復を続けるような探索法が
いわゆる黄金分割探索である。
このアプローチでは、図4.8で示されるようにFibonacci探索のように区間列
$\lbrace I\_1, I\_2, I\_3 , \cdots　\rbrace$を、$(4.2)$の再帰的関数を用いて生成する。
連続した区間を生み出す規則はどの隣接した二つの区間の比も一定になるものである、すなわち

$$\frac{I\_k}{I\_{k+1}} = \frac{I\_{k+1}}{I\_{k+2}} = \frac{I\_{k+2}}{I\_{k+3}} = \cdots = K \ \text{(4.19)}$$

つまり、

$$
  \frac{I\_k}{I\_{k+2}} = K^2 \ \text{(4.20)} \\\\
  \frac{I\_k}{I\_{k+3}} = K^3
$$

などが成り立つ。

式$(4.2)$を$I\_{k+2}$で割るにあたり、

$$\frac{I\_k}{I\_{k+2}} = \frac{I\_{k+1}}{I_{k+2}} + 1 \ \text{(4.21)}$$

得る、そして式$(4.19)$から式$(4.20)$までを用いると

$$K^2 = K + 1 \ \text{(4.22)}$$

今,$K$を解くと

$$K = \frac{1 \pm \sqrt{5}}{2} \ \text{(4.23)}$$

を得る。

$K$の負の値は不適切なので、$K = 1.618034$となる。
この定数は黄金比として有名である。この用語は古代ギリシャで辺の比が$1 : K$
となる四角形が最も美しい四角形であると考えられていた事実に由来していて、
そしてその後黄金比として知られるようになったものである。
同様に、$\lbrace I\_1, I\_1/K , I\_1 / K^2 , \dots , I\_1 / K^{n-1} \rbrace$
の数列は黄金分割数列として知られるようになった

左の区間が常に選択された条件下での黄金分割探索が図4.8に示されている。
図のように、この探索法は多くの点でFibonacci探索に似ている。
2つの例外は

1. 連続した区間はnに依存しない。従って、反復は不確実な区間か目的関数の値の変化がある許容誤差
   $\epsilon$より低くなるまで繰り返される。
2. 連続した区間同士の比は、つまり$F\_{n-k-1} / F\_{n-k}$は、式$(4.22)$-$(4.23)$により
   $$\frac{1}{K} = K - 1 = 0.618034$$
   になるような$1/K$に置き換えられる。

である。

黄金分割探索の効率は簡単にFibonacci探索の効率と比較できる。
既知の、大きな値の$n$を適用する$F\_n$と$K$の間の関係は

$$F\_n \approx \frac{K^{n+1}}{\sqrt{5}} \ \text{(4.24)}$$

である(e.g. $n=11, F\_n =144$ かつ $K^{n+1} / \sqrt{5} \approx 144.001$)
従って、式$(4.5)$と式$(4.24)$はFibonacci探索に対して、

$$ \Lambda\_F = I\_n = \frac{I\_1}{F\_n} \approx \frac{\sqrt{5}}{K^{n+1}} I\_1 $$

のような不確実な範囲を与える。

似たように、黄金分割探索に対しては,

$$\Lambda\_{GS} = I\_n = \frac{I\_1}{K^{n-1}}$$

それゆえに

$$ \frac{\Lambda{GS}}{\Lambda\_F} \approx \frac{K^2}{\sqrt{5}} \approx 1.17 $$

が成り立つ。

従って、もし反復の回数が二つの方法で同じであれば、黄金分割探索法の不確実な範囲は、
Fibonacci探索の不確実な範囲と比べて$17\%$大きな範囲となる。
あるいは、黄金分割探索はFibonacci探索と同じだけの正確さを達成するためにより多くの反復を必要とするだろう。
しかしながら、この不利益は合計の反復回数を最適化の開始時に与える必要がない事実によって相殺される。

黄金分割探索の実装は以下のものである

## アルゴリズム4.2 黄金分割探索
### Step1
$x\_{L,1}, x\_{U,1}, \epsilon$を入力する 

### Step2
$I\_1 = x\_{U,1} - x\_{L,1}, K = 1.618034$ と割り当て、

$$
\begin{array}{cc}
    I\_2 = I\_1 / K \\\\
    x\_{a,1} = x\_{U,1} - I\_2, & x\_{b,1} = x\_{L,1} + I\_2 \\\\
    f\_{a,1} = f(x\_{a,1}), & f\_{b,1} = f(x\_{b,1})
\end{array}
$$

を計算し、 $k = 1$とおく。

### Step3
$$ I\_{k+2} = I\_{k+1} / K $$
を計算する。

$f\_{a,k} \geq f{b,k}$の場合、

$x\_{L,k+1}, x\_{U,k+1}, x\_{a,k+1}, x\_{b,k+1}, f\_{a,k+1}, f\_{b,k+1}$

を式$(4.7)$から$(4.12)$を用いて更新する。

さもなければ、つまり$f\_{a,k} < f\_{b,k}$の場合、式$(4.13)$から$(4.18)$を用いて、情報を更新する。

### Step4
$I\_k < \epsilon$または$x\_{a,k+1} > x\_{b,k+1}$の場合は、以下を実行する
 
- $f\_{a,k+1} > f\_{b,k+1}$ の場合
  - $x^\ast = \frac{1}{2}(x\_{b,k+1} + x\_{u,k+1)}$を計算する
- $f\_{a,k+1} = f\_{b,k+1}$ の場合
  - $x^\ast = \frac{1}{2}(x\_{a,k+1} + x\_{a,k+1)}$を計算する
- $f\_{a,k+1} < f\_{b,k+1}$ の場合
  - $x^\ast = \frac{1}{2}(x\_{L,k+1} + x\_{a,k+1)}$を計算する

$f^\ast = f(x^\ast)$ を計算する
$x^\ast, f^\ast$を出力し、終了

### Step5
$k = k + 1$と置き、Step3から繰り返す。
